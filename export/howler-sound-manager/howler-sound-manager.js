var gdjs;(function(f){const g=new f.Logger("Audio manager"),S={preload:!0,onplayerror:(h,t)=>g.error("Can't play an audio file: "+t),onloaderror:(h,t)=>g.error("Error while loading an audio file: "+t)},w=h=>h>1?1:h<0?0:h;class H{constructor(t,e,s,o){this._id=null;this._oncePlay=[];this._onPlay=[];this._howl=t,this._initialVolume=w(e),this._loop=s,this._rate=o}isLoaded(){return this._howl.state()==="loaded"}play(){if(this.isLoaded()){const t=this._howl.play(this._id===null?"__default":this._id);this._id=t,this._howl.volume(this._initialVolume,t),this._howl.loop(this._loop,t),this._howl.rate(f.HowlerSoundManager.clampRate(this._rate),t),this._onPlay.forEach(e=>{this.on("play",e),e(t)}),this._oncePlay.forEach(e=>e(t)),this._onPlay=[],this._oncePlay=[]}else this._howl.once("load",()=>this.play());return this}pause(){return this._id!==null&&this._howl.pause(this._id),this}stop(){return this._id!==null&&this._howl.stop(this._id),this}playing(){return(this._id!==null?this._howl.playing(this._id):!0)||!this.isLoaded()}paused(){return!this.playing()}stopped(){return this.paused()&&this.getSeek()===0}getRate(){return this._rate}setRate(t){return this._rate=t,this._id!==null&&(t=f.HowlerSoundManager.clampRate(t),this._howl.rate(t,this._id)),this}getLoop(){return this._loop}setLoop(t){return this._loop=t,this._id!==null&&this._howl.loop(t,this._id),this}getVolume(){return this._id===null?this._initialVolume:this._howl.volume(this._id)}setVolume(t){return this._initialVolume=w(t),this._id!==null&&this._howl.volume(this._initialVolume,this._id),this}getMute(){return this._id===null?!1:this._howl.mute(this._id)}setMute(t){return this._id!==null&&this._howl.mute(t,this._id),this}getSeek(){return this._id===null?0:this._howl.seek(this._id)}setSeek(t){return this._id!==null&&this._howl.seek(t,this._id),this}getSpatialPosition(t){return this._id===null?0:this._howl.pos(this._id)[t==="x"?0:t==="y"?1:2]}setSpatialPosition(t,e,s){return this._id!==null&&this._howl.pos(t,e,s,this._id),this}fade(t,e,s){return this._id!==null&&this._howl.fade(w(t),w(e),s,this._id),this}on(t,e){return t==="play"?this._id===null?this._onPlay.push(e):this._howl.on(t,e,this._id):this._id===null?this.once("play",()=>this.on(t,e)):this._howl.on(t,e,this._id),this}once(t,e){return t==="play"?this._id===null?this._oncePlay.push(e):this.playing()?e(this._id):this._howl.once(t,e,this._id):this._id===null?this.once("play",()=>this.once(t,e)):this._howl.once(t,e,this._id),this}off(t,e){return this._id!==null&&this._howl.off(t,e,this._id),this}}f.HowlerSound=H;class b{constructor(t){this._loadedMusics={};this._loadedSounds={};this._availableResources={};this._globalVolume=100;this._sounds={};this._musics={};this._freeSounds=[];this._freeMusics=[];this._pausedSounds=[];this._paused=!1;this._resources=t;const e=this;document.addEventListener("deviceready",function(){document.addEventListener("pause",function(){const s=e._freeSounds.concat(e._freeMusics);for(let o in e._sounds)e._sounds.hasOwnProperty(o)&&s.push(e._sounds[o]);for(let o in e._musics)e._musics.hasOwnProperty(o)&&s.push(e._musics[o]);for(let o=0;o<s.length;o++){const i=s[o];!i.paused()&&!i.stopped()&&(i.pause(),e._pausedSounds.push(i))}e._paused=!0},!1),document.addEventListener("resume",function(){for(let s=0;s<e._pausedSounds.length;s++){const o=e._pausedSounds[s];o.stopped()||o.play()}e._pausedSounds.length=0,e._paused=!1},!1)})}setResources(t){this._resources=t}static clampRate(t){return t>4?4:t<.5?.5:t}_getFileFromSoundName(t){return this._availableResources.hasOwnProperty(t)&&this._availableResources[t].file?this._availableResources[t].file:t}_storeSoundInArray(t,e){for(let s=0,o=t.length;s<o;++s)if(t[s]!==null&&t[s].stopped())return t[s]=e,e;return t.push(e),e}createHowlerSound(t,e,s,o,i){const l=this._getFileFromSoundName(t),u=e?this._loadedMusics:this._loadedSounds;return u.hasOwnProperty(l)||(u[l]=new Howl(Object.assign({src:[l],html5:e,volume:0},S))),new f.HowlerSound(u[l],s,o,i)}loadAudio(t,e){const s=this._getFileFromSoundName(t),o=e?this._loadedMusics:this._loadedSounds;o.hasOwnProperty(s)||(o[s]=new Howl(Object.assign({src:[s],html5:e,volume:0},S)))}unloadAudio(t,e){const s=this._getFileFromSoundName(t),o=e?this._loadedMusics:this._loadedSounds;if(!o[s])return;const i=o[s];function l(u){for(let d in u)u[d]&&u[d]._howl===i&&(u[d].stop(),delete u[d])}l(this._freeMusics),l(this._freeSounds),l(Object.values(this._musics)),l(Object.values(this._sounds)),l(this._pausedSounds),o[s].unload(),delete o[s]}unloadAll(){Howler.unload(),this._freeSounds.length=0,this._freeMusics.length=0,this._sounds={},this._musics={},this._pausedSounds.length=0,this._loadedMusics={},this._loadedSounds={}}playSound(t,e,s,o){const i=this.createHowlerSound(t,!1,s/100,e,o);this._storeSoundInArray(this._freeSounds,i),i.once("play",()=>{this._paused&&(i.pause(),this._pausedSounds.push(i))}),i.play()}playSoundOnChannel(t,e,s,o,i){this._sounds[e]&&this._sounds[e].stop();const l=this.createHowlerSound(t,!1,o/100,s,i);this._sounds[e]=l,l.once("play",()=>{this._paused&&(l.pause(),this._pausedSounds.push(l))}),l.play()}getSoundOnChannel(t){return this._sounds[t]||null}playMusic(t,e,s,o){const i=this.createHowlerSound(t,!0,s/100,e,o);this._storeSoundInArray(this._freeMusics,i),i.once("play",()=>{this._paused&&(i.pause(),this._pausedSounds.push(i))}),i.play()}playMusicOnChannel(t,e,s,o,i){this._musics[e]&&this._musics[e].stop();const l=this.createHowlerSound(t,!0,o/100,s,i);this._musics[e]=l,l.once("play",()=>{this._paused&&(l.pause(),this._pausedSounds.push(l))}),l.play()}getMusicOnChannel(t){return this._musics[t]||null}setGlobalVolume(t){this._globalVolume=t,this._globalVolume>100&&(this._globalVolume=100),this._globalVolume<0&&(this._globalVolume=0),Howler.volume(this._globalVolume/100)}getGlobalVolume(){return this._globalVolume}clearAll(){Howler.stop(),this._freeSounds.length=0,this._freeMusics.length=0,this._sounds={},this._musics={},this._pausedSounds.length=0}preloadAudio(t,e,s){s=s||this._resources;const o={};for(let a=0,r=s.length;a<r;++a){let n=s[a];if(n.file&&n.kind==="audio"){if(this._availableResources[n.name])continue;this._availableResources[n.name]=n,o[n.file]=(o[n.file]||[]).concat(n)}}const i=Object.keys(o),l=i.length;if(l===0)return e(l);let u=0;const d=(a,r)=>{if(r&&g.warn("There was an error while preloading an audio file: "+r),u++,u===l)return e(l);t(u,l),y()},m=(a,r,n)=>{const _=n?this._loadedMusics:this._loadedSounds;_[a]=new Howl(Object.assign({},S,{src:[a],onload:r,onloaderror:r,html5:n,volume:0}))},y=()=>{if(!i.length)return;const a=i.shift(),r=o[a][0];let n=0;const _=(c,p)=>{n--,n||d(c,p)};if(r.preloadAsMusic&&(n++,m(a,_,!0)),r.preloadAsSound)n++,m(a,_,!1);else if(r.preloadInCache){n++;const c=new XMLHttpRequest;c.addEventListener("load",_),c.addEventListener("error",p=>_(p,"XHR error: "+a)),c.addEventListener("abort",p=>_(p,"XHR abort: "+a)),c.open("GET",a),c.send()}n||d()};y()}}f.HowlerSoundManager=b,f.SoundManager=b})(gdjs||(gdjs={}));
//# sourceMappingURL=howler-sound-manager.js.map
